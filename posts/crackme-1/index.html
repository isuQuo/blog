<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Crackme challenge #1 | My blog</title><meta name=keywords content><meta name=description content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system."><meta name=author content><link rel=canonical href=https://isuquo.github.io/posts/crackme-1/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Crackme challenge #1"><meta property="og:description" content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system."><meta property="og:type" content="article"><meta property="og:url" content="https://isuquo.github.io/posts/crackme-1/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Crackme challenge #1"><meta name=twitter:description content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Crackme challenge #1","item":"https://isuquo.github.io/posts/crackme-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Crackme challenge #1","name":"Crackme challenge #1","description":"7eRoM - 1st one challenge Welcome to my first blog post. Today, we\u0026rsquo;ll be attempting to crack 7eRoM\u0026rsquo;s Crackme called \u0026ldquo;1st one challenge\u0026rdquo;.\nWhen executing the app, you are prompted for a password:\nThe app exits afterwards.\nIf we debug the app in Ollydbg, we get a slightly different output after entering in the same password:\nFinding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system.","keywords":[],"articleBody":"7eRoM - 1st one challenge Welcome to my first blog post. Today, we’ll be attempting to crack 7eRoM’s Crackme called “1st one challenge”.\nWhen executing the app, you are prompted for a password:\nThe app exits afterwards.\nIf we debug the app in Ollydbg, we get a slightly different output after entering in the same password:\nFinding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to https://www.embecosm.com/appnotes/ean9/html/ch05s02.html, a few initialization steps need to be taken before calling the main function.\nWe can identify common calls made by the CRT system in order to get closer to the main function. These calls include kernel32.GetCommandLineX and kernel32.GetEnvironmentStringsX.\nIn the main CPU window, right click anywhere and hover over ‘Search for’ and select ‘All intermodular calls’. Click on the Destination tab to sort the library calls by name. We will first take a look at kernel32.GetEnvironmentStringsW and set a breakpoint on it (F2).\nWhen starting the app, we hit the breakpoint. We can single step from here and shortly thereafter, the CMD window asking for the password pops up. We can backtrack from here to ascertain this as our main function.\nIf we view the above in IDA (graph view makes it easier for us to find the main function), we can create a chart that shows us how many calls were made from the main function:\nIt might be hard to see, but I renamed the function in cyan blue to “function_before_main”.\nAnother way we can find our way to the main function is utilizing the referenced strings. We find some interesting ones at that:\nWe can double click the text in Ollydbg to find where it is used in memory.\nFinding the correct password When we call into the main function, we can see our “password:” string being pushed onto the stack at 0x403BA0. Before pushing the string, a jump condition is met. If the jump condition is equal to 0, we jump over our string.\nWe can decompile this function with Ghidra to reveal two outcomes based on this jump condition:\nWe do not take the jump, so we fall through to the else clause. We’ll take a look at this path first.\nIt appears some heavy math is involved in order to get the correct password:\nWe can see our “Password is not correct” string. I was not able to find a way to get the correct password when taking this route unless I patch the instructions, which makes it too easy.\nHow do we take the other path? We can obviously patch the jump condition instruction, but let’s see what it’s checking against first.\nAccording to the screenshot below, we can see offset 0x18 in the FS segment register is being accessed. Offset 0x30 is accessed from there, and another offset of 0x2. This is moved into EDX and is the basis of our jump condition.\nAccording to https://en.wikipedia.org/wiki/Win32_Thread_Information_Block, offset 0x18 is the linear address of the thread environment block (TEB) and offset 0x30 is the linear address of the process environment block (PEB). Offset 0x2 from the PEB points to an interesting discovery:\nstruct _PEB { 0x000 BYTE InheritedAddressSpace; 0x001 BYTE ReadImageFileExecOptions; 0x002 BYTE BeingDebugged; The app is essentially detecting that we’re using a debugger. In order to patch this, we can change the instruction from AND EDX,0FF to MOV EDX,0\nThis way, the result from calling BeingDebugged is false, now we can move onto discovering the password.\nWe see now that the app is using LoadLibraryA and GetProcAddress to use the printf function to print “password: \" to the console. I assume it’s done this way as a means to trick the reverser into believing the other path was the way to go.\nRight after we enter in our password, we can see something interesting in memory:\nIs that the password we’re looking for? Jumping back into IDA, at address 0x403C98 the first byte of our password is compared with the first byte of “Simple?” (“S”). We will patch the instructions in Ollydbg in order to make the app think the comparisons are correct. After that, the next byte from each password are compared. Same as again, we’ll patch the jump instruction to see where it leads us.\nThe first two bytes are taken off from each password and the now first bytes are being compared against each other.\nAfter stepping through this function and making sure each check is correct, we get the following message:\nI think we know what the password is. Let’s execute the Crackme without running the debugger and give it a go:\n","wordCount":"773","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/crackme-1/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Crackme challenge #1</h1><div class=post-meta></div></header><div class=post-content><h1 id=7erom---1st-one-challenge>7eRoM - 1st one challenge<a hidden class=anchor aria-hidden=true href=#7erom---1st-one-challenge>#</a></h1><p>Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.</p><p>When executing the app, you are prompted for a password:</p><p><img loading=lazy src=images/1.PNG alt></p><p>The app exits afterwards.</p><p>If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:</p><p><img loading=lazy src=images/2.PNG alt></p><h2 id=finding-the-main-function>Finding the main function<a hidden class=anchor aria-hidden=true href=#finding-the-main-function>#</a></h2><p>When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to <a href=https://www.embecosm.com/appnotes/ean9/html/ch05s02.html>https://www.embecosm.com/appnotes/ean9/html/ch05s02.html</a>, a few initialization steps need to be taken before calling the main function.</p><p>We can identify common calls made by the CRT system in order to get closer to the main function. These calls include kernel32.GetCommandLineX and kernel32.GetEnvironmentStringsX.</p><p>In the main CPU window, right click anywhere and hover over &lsquo;Search for&rsquo; and select &lsquo;All intermodular calls&rsquo;. Click on the Destination tab to sort the library calls by name. We will first take a look at kernel32.GetEnvironmentStringsW and set a breakpoint on it (F2).</p><p>When starting the app, we hit the breakpoint. We can single step from here and shortly thereafter, the CMD window asking for the password pops up. We can backtrack from here to ascertain this as our main function.</p><p>If we view the above in IDA (graph view makes it easier for us to find the main function), we can create a chart that shows us how many calls were made from the main function:</p><p><img loading=lazy src=images/3.PNG alt></p><p>It might be hard to see, but I renamed the function in cyan blue to &ldquo;function_before_main&rdquo;.</p><p>Another way we can find our way to the main function is utilizing the referenced strings. We find some interesting ones at that:</p><p><img loading=lazy src=images/4.PNG alt></p><p>We can double click the text in Ollydbg to find where it is used in memory.</p><h2 id=finding-the-correct-password>Finding the correct password<a hidden class=anchor aria-hidden=true href=#finding-the-correct-password>#</a></h2><p>When we call into the main function, we can see our &ldquo;password:&rdquo; string being pushed onto the stack at 0x403BA0. Before pushing the string, a jump condition is met. If the jump condition is equal to 0, we jump over our string.</p><p>We can decompile this function with Ghidra to reveal two outcomes based on this jump condition:</p><p><img loading=lazy src=images/5.PNG alt></p><p><img loading=lazy src=images/6.PNG alt></p><p>We do not take the jump, so we fall through to the else clause. We&rsquo;ll take a look at this path first.</p><p>It appears some heavy math is involved in order to get the correct password:</p><p><img loading=lazy src=images/7.PNG alt></p><p>We can see our &ldquo;Password is not correct&rdquo; string. I was not able to find a way to get the correct password when taking this route unless I patch the instructions, which makes it too easy.</p><p>How do we take the other path? We can obviously patch the jump condition instruction, but let&rsquo;s see what it&rsquo;s checking against first.</p><p>According to the screenshot below, we can see offset 0x18 in the FS segment register is being accessed. Offset 0x30 is accessed from there, and another offset of 0x2. This is moved into EDX and is the basis of our jump condition.</p><p><img loading=lazy src=images/8.PNG alt></p><p>According to <a href=https://en.wikipedia.org/wiki/Win32_Thread_Information_Block>https://en.wikipedia.org/wiki/Win32_Thread_Information_Block</a>, offset 0x18 is the linear address of the thread environment block (TEB) and offset 0x30 is the linear address of the process environment block (PEB). Offset 0x2 from the PEB points to an interesting discovery:</p><pre tabindex=0><code>struct _PEB {
    0x000 BYTE InheritedAddressSpace;
    0x001 BYTE ReadImageFileExecOptions;
    0x002 BYTE BeingDebugged;
</code></pre><p>The app is essentially detecting that we&rsquo;re using a debugger. In order to patch this, we can change the instruction from <code>AND EDX,0FF</code> to <code>MOV EDX,0</code></p><p>This way, the result from calling BeingDebugged is false, now we can move onto discovering the password.</p><p><img loading=lazy src=images/9.PNG alt></p><p>We see now that the app is using LoadLibraryA and GetProcAddress to use the printf function to print &ldquo;password: " to the console. I assume it&rsquo;s done this way as a means to trick the reverser into believing the other path was the way to go.</p><p>Right after we enter in our password, we can see something interesting in memory:</p><p><img loading=lazy src=images/10.PNG alt></p><p>Is that the password we&rsquo;re looking for? Jumping back into IDA, at address 0x403C98 the first byte of our password is compared with the first byte of &ldquo;Simple?&rdquo; (&ldquo;S&rdquo;). We will patch the instructions in Ollydbg in order to make the app think the comparisons are correct. After that, the next byte from each password are compared. Same as again, we&rsquo;ll patch the jump instruction to see where it leads us.</p><p>The first two bytes are taken off from each password and the now first bytes are being compared against each other.</p><p>After stepping through this function and making sure each check is correct, we get the following message:</p><p><img loading=lazy src=images/11.PNG alt></p><p>I think we know what the password is. Let&rsquo;s execute the Crackme without running the debugger and give it a go:</p><p><img loading=lazy src=images/12.PNG alt></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>